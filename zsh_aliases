alias be='bundle exec'
alias smate='ssh -R 52698:localhost:52698'
alias pserver='python -m SimpleHTTPServer'

# nginx

function ngs {
  echo "Starting nginx ..."
  sudo nginx
}

function ngq {
  echo "Stopping nginx ..."
  sudo nginx -s stop
}

function ngr {
  echo "Reloading nginx config ..."
  sudo nginx -s reload
}

# postgresql

function pgs {
  echo "Starting PostgreSQL server ..."
  lunchy start -w postgres
}

function pgq {
  echo "Stopping PostgreSQL server ..."
  lunchy stop postgres
}

function pgr {
  echo "Restarting PostgreSQL server ..."
  lunchy restart postgres
}

# cdgem

function cg {
  gems=( $(find `gem env gemdir`/gems -d -iname "*$1*" -mindepth 1 -maxdepth 1) )
  gem_path=""
  if [ ${#gems[@]} -gt 1 ]; then
    echo "\tThere's more than one gem founded:\n"
    N=1
    for i in "${gems[@]}"; do
      echo "\t$N) ${i##*/}"
      let "N = $N + 1"
    done
    echo "\n\tPlease, enter gem number you want to go for:"
    read number
    if [[ $(echo {1..${#gems[@]}}) =~ $number ]]; then
      gem_path=${gems[$number]}
    else
      return 1
    fi
  else
    gem_path=$gems
  fi
  pushd $gem_path && clear
}

# rails

cd_to_app="cd to app directory first"
puma_config="./config/puma.rb"
puma_pid="./tmp/pids/puma.pid"
unicorn_config="./config/unicorn.rb"
unicorn_pid="./tmp/pids/unicorn.pid"

function bundled {
  if [ -f ./Gemfile ]; then
    check=$(cat ./Gemfile | grep -i $1 2> /dev/null) && [ $check ]
  else
    return 1
  fi
}

function sc {
  if [ -f ./config/environment.rb ] && [ $(rbenv which pry) ]; then
    pry -r./config/environment.rb
  elif [ -x script/rails ]; then
    script/rails console
  elif [ -x script/console ]; then
    script/console
  else
    echo $cd_to_app
  fi
}

function ss {
  if [ -f $unicorn_config ] && bundled unicorn; then
    echo "Starting Unicorn ..."
    bundle exec unicorn_rails -E development -c $unicorn_config -D
  elif [ -x script/server ]; then
    echo "Starting Rails 2 server ..."
    script/server
  elif [ -x script/rails ]; then
    echo "Starting Rails 3 server ..."
    script/rails server
  else
    echo $cd_to_app
  fi
}

function ssp {
  if [ -f $unicorn_config ] && bundled unicorn; then
    echo "Starting Unicorn in production ..."
    bundle exec unicorn_rails -E production -c $unicorn_config -D
  elif [ -x script/server ]; then
    echo "Starting Rails 2 server in production ..."
    script/server production
  elif [ -x script/rails ]; then
    echo "Starting Rails 3 server in production ..."
    script/rails server -e production
  else
    echo $cd_to_app
  fi
}

function sq {
  if [ -f $unicorn_pid ]; then
    echo "Stopping Unicorn ..."
    kill `cat $unicorn_pid`
  elif [ -f tmp/pids/server.pid ]; then
    echo "Stopping Rails server ..."
    kill `cat tmp/pids/server.pid`
  else
    echo $cd_to_app
  fi
}

function sr {
  if [ -f $unicorn_pid ]; then
    echo "Restarting Unicorn ..."
    kill -s USR2 `cat $unicorn_pid`
  elif [ -f tmp/pids/server.pid ]; then
    echo "Restarting Rails server ..."
    kill -s USR2 `cat tmp/pids/server.pid`
  elif [ -d tmp ]; then
    echo "Restarting Passenger instances ..."
    touch tmp/restart.txt
  else
    echo $cd_to_app
  fi
}
